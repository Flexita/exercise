<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width= , initial-scale=1.0">
    <title>è´­ç‰©è½¦</title>
    <style>
        html,
        body {
            padding: 0;
            margin: 0;
        }

        .container {
            padding: 15px;
            box-sizing: border-box;
        }

        .active {
            background-color: #ddd;
        }

        .message-box {
            width: 100%;
            padding: 10px 20px;
            box-sizing: border-box;
        }

        .success {
            background: #4fc08d;
            border: 1px solid #42b983;
        }

        .warning {
            background: #f66;
            border: 1px solid #d63200;
        }

        .message-box-close {
            float: right;
            color: #fff;
        }

        /* åŠ¨ç”»ç›¸å…³æ ·å¼ */
        /* å…¥åœºå‰ */
        /* .fade-enter,
        .fade-leave-to {
            opacity: 0;
        } */

        /* è¿‡åº¦ */
        /* .fade-enter-active,
        .fade-leave-active {
            transition: opacity linear 0.5s;
        } */
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
</head>

<body>
    <!-- å®¿ä¸»æ–‡ä»¶/Appå…¥å£ -->
    <div id="app">

        <!-- å¼¹çª—ç»„ä»¶ -->
        <!-- <message :show="show" @close="show = $event"> -->
        <!-- <message :show.sync="show" @update:show="show = $event" class="success"></message> -->
        <message ref='msgSuccess' class="success">
            <template v-slot:title="slotProps">
                <strong>{{slotProps.title}}</strong>
            </template>
            <template v-slot:default>
                æ–°å¢è¯¾ç¨‹æˆåŠŸï¼
            </template>
        </message>

        <message ref='msgWarning' class="warning">
            <template v-slot:title>
                <strong>è­¦å‘Š</strong>
            </template>
            <template v-slot:default>
                è¯·è¾“å…¥è¯¾ç¨‹åç§°ï¼
            </template>
        </message>

        <div class="container">
            <!-- æ’å€¼æ–‡æœ¬ -->
            <h2 :title="title" v-text="title"></h2>

            <!-- æ’ä»¶ä½¿ç”¨ -->
            <heading></heading>

            <!-- æ‰¹é‡å…³é—­å¼¹çª— -->
            <button v-permission="'admin'" class="toolbar" @click="$bus.$emit('message-close')">å…³é—­å¼¹çª—</button>

            <!-- ç”¨æˆ·è¾“å…¥â€”â€”ğŸ”› -->
            <!-- ç»„ä»¶åŒ– ä¹‹å‰ -->
            <!-- ç»„ä»¶æœ€ç»ˆçš„è¾“å‡ºç›®æ ‡åº”è¯¥æ˜¯è™šæ‹ŸDOM -->
            <!-- ç»„ä»¶é…ç½® => VueComponentå®ä¾‹ => render() => Virtual DOM => DOM -->
            <!-- <p>
                <input v-model="course" type="text" v-on:keydown.enter="addCourse" />
                <button @click="addCourse">æ–°å¢</button>
            </p> -->
            <!-- ç»„ä»¶åŒ– ä¹‹å -->
            <!-- <course-add @add-course='addCourse'></course-add> -->
            <!-- è‡ªå®šä¹‰ç»„ä»¶â€”â€”æ•°æ®åŒå‘ç»‘å®š -->
            <course-add v-model="course" @add-course='addCourse'></course-add>

            <!-- <course-add :value="course" @input="course = $event" @add-course='addCourse'></course-add> -->
            <!-- ç”¨æˆ·è¾“å…¥â€”â€”ğŸ”š -->

            <!-- æ‰¹é‡æ›´æ–°ä»·æ ¼ -->
            <p><input type="text" v-model.number='price'><button @click="batchUpdate">æ›´æ–°ä»·æ ¼</button></p>

            <!-- åˆ—è¡¨æ¸²æŸ“â€”â€”ğŸ”› -->
            <!-- course-list ç»„ä»¶åŒ– ä¹‹å‰-->
            <!-- æ¡ä»¶æ¸²æŸ“ -->
            <!-- <p v-if="courses.length <= 0">æ²¡æœ‰ä»»ä½•è¯¾ç¨‹ä¿¡æ¯</p> -->
            <!-- åˆ—è¡¨æ¸²æŸ“_åŠ¨æ€ç»‘å®šclass -->
            <!-- <div v-for="c in courses" :key="c" :class="{active: selectedCourse === c}" @click='selectedCourse = c'>
                {{ c }}
            </div> -->

            <!-- åŠ¨æ€ç»‘å®šstyle -->
            <!-- <div class="course-list" v-else>
                <div v-for="c in courses" :key="c"
                    :style="{backgroundColor: selectedCourse === c ? '#ddd' : 'transparent'}"
                    @click='selectedCourse = c'>
                    {{ c }}
                </div>
            </div> -->

            <!-- course-list ç»„ä»¶åŒ– ä¹‹å-->
            <course-list :courses="courses"></course-list>
            <!-- åˆ—è¡¨æ¸²æŸ“â€”â€”ğŸ”š -->

            <!-- å•†å“æ€»æ•° -->
            <p>
                <!-- è¡¨è¾¾å¼ -->
                <!-- è¯¾ç¨‹æ€»æ•°ï¼š{{courses.length + ' é—¨'}} -->
                <!-- è®¡ç®—å±æ€§ -->
                <!-- è¯¾ç¨‹æ€»æ•°ï¼š{{total}} -->
                <!-- ç›‘å¬å™¨ -->
                è¯¾ç¨‹æ€»æ•°ï¼š{{totalCount}}
            </p>
        </div>
    </div>
    <script src="./vue.js"></script>
    <!-- å¼•å…¥æ’ä»¶ -->
    <script src="./plugins//heading.js"></script>
    <!-- CDNå¼•å…¥ -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script> -->
    <script>
        const role = 'user';
        // äº‹ä»¶æ€»çº¿
        Vue.prototype.$bus = new Vue();
        // æ··å…¥
        const Mixin = {
            data() {
                return {
                    say: 'Say hello from mixin!'
                }
            },
            created() {
                // thisè¡¨ç¤ºç»„ä»¶çš„å®ä¾‹
                this.hello()
            },
            methods: {
                hello() {
                    console.log(this.say, '==============>>>')
                }
            }
        }

        // ç»„ä»¶åŒ–â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”é«˜å†…èšã€ä½è€¦åˆâ€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”

        // è¿‡æ»¤å™¨ï¼ˆå…¨å±€ï¼‰
        /* Vue.filter('currency', function (params) {
            return params
        })*/

        // è‡ªå®šä¹‰æŒ‡ä»¤
        Vue.directive('focus', {
            inserted(el, binding) {
                el.focus()
            }
        })

        Vue.directive('permission', {
            inserted(el, binding) {
                // è‹¥æŒ‡å®šç”¨æˆ·è§’è‰²ä¸å½“å‰è§’è‰²ä¸åŒ¹é…ï¼Œç§»é™¤å½“å‰æŒ‡ä»¤ç»‘å®šçš„å…ƒç´ 
                if (role !== binding.value) {
                    el.parentElement.removeChild(el)
                }
            }
        })

        // è¯¾ç¨‹åˆ—è¡¨ç»„ä»¶â€”â€”ğŸ”›
        Vue.component('course-list', {
            data() {
                return {
                    selectedCourse: undefined
                }
            },
            // æ¥æ”¶çš„å‚æ•°
            props: {
                courses: {
                    type: Array,
                    default: []
                },
            },
            template: `<div>
                <p v-if="courses.length <= 0">æ²¡æœ‰ä»»ä½•è¯¾ç¨‹ä¿¡æ¯</p>
                <!-- åˆ—è¡¨æ¸²æŸ“_åŠ¨æ€ç»‘å®šclass -->
                <!-- <div v-for="c in courses" :key="c" :class="{active: selectedCourse === c}" @click='selectedCourse = c'>
                    {{ c }}
                </div> -->
                <!-- åŠ¨æ€ç»‘å®šstyle -->
                <div class="course-list" v-else>
                    <div v-for="c in courses" :key="c.name" :style="{backgroundColor: selectedCourse === c ? '#ddd' : 'transparent'}"
                        @click='selectedCourse = c'>
                        {{ c.name }}â€”â€”{{c.price | currency('ï¿¥')}}
                    </div>
                </div>
            </div>
            `,
            filters: {
                currency(value, symbol = 'ï¿¥') {
                    return symbol + value
                }
            }
        })
        // è¯¾ç¨‹åˆ—è¡¨ç»„ä»¶â€”â€”ğŸ”š

        // æ–°å¢è¯¾ç¨‹ç»„ä»¶â€”â€”ğŸ”›
        Vue.component('course-add', {
            mixins: [Mixin],
            props: ['value'],
            template: `
                <div>
                    <!-- ç”¨æˆ·è¾“å…¥ -->
                    <p>
                        <input :value="value" v-focus type="text" 
                            @input="onInput" 
                            @keydown.enter="addCourse" />
                        <button @click="addCourse">æ–°å¢</button>
                    </p>
                </div>
            `,
            methods: {
                addCourse() {
                    // æ´¾å‘æ—¶é—´ï¼Œé€šçŸ¥çˆ¶ç»„ä»¶æ›´æ–°æ•°æ®
                    this.$emit('add-course')
                },
                // ç»„ä»¶è¾“å…¥äº‹ä»¶
                onInput(e) {
                    this.$emit('input', e.target.value)
                },
            },

        })
        // æ–°å¢è¯¾ç¨‹ç»„ä»¶â€”â€”ğŸ”š

        // å¼¹çª—ç»„ä»¶â€”â€”ğŸ”›
        Vue.component('message', {
            // props: ['show'],
            data() {
                return {
                    show: false
                }
            },
            template: `
                <transition 
                    enter-active-class="animate__animated animate__bounceIn" 
                    leave-active-class="animate__animated animate__bounceOut">
                    <div class="message-box" v-if="show">
                        <!-- é€šè¿‡slotè·å–ä¼ å…¥å‚æ•° -->
                        <slot name="title" title="æ­å–œ">é»˜è®¤æ ‡é¢˜</slot>
                        <slot></slot>
                        <span class="message-box-close" @click="toggle">X</span>
                    </div>
                </transition>
            `,
            mounted() {
                this.$bus.$on('message-close', () => {
                    // this.$emit('update:show', false)
                    this.toggle()
                })
            },
            methods: {
                toggle() {
                    this.show = !this.show
                }
            },
        })
        // å¼¹çª—ç»„ä»¶â€”â€”ğŸ”š

        // æ¨¡æ‹Ÿå¼‚æ­¥æ•°æ®è°ƒç”¨
        function getCourses(params) {
            return new Promise(resolve => {
                setTimeout(() => {
                    resolve([{
                        name: 'webå…¨æ ˆ'
                    }, {
                        name: 'webé«˜çº§'
                    }])
                }, 2000)
            })
        }

        // 1. åˆ›å»ºVueå®ä¾‹â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
        const app = new Vue({
            el: '#app',
            data() {
                return {
                    title: 'è´­ç‰©è½¦',
                    course: undefined,
                    courses: [],
                    totalCount: 0,
                    // show: false,
                    // showWarn: false,
                    price: 0
                }
            },
            // èƒ½ç”¨computedç”¨computed
            computed: {
                total() {
                    // è®¡ç®—å±æ€§æ˜¯æœ‰ç¼“å­˜æ€§è´¨çš„ï¼Œå¦‚æœthis.courses.lengthå€¼æ²¡æœ‰å˜åŒ–ï¼Œtotalæ˜¯ä¸ä¼šé‡æ–°è®¡ç®—çš„ï¼Œé¡µé¢ä¸ä¼šé‡æ–°æ¸²æŸ“
                    return this.courses.length + ' é—¨'
                }
            },
            // é»˜è®¤æƒ…å†µä¸‹watchï¼Œåˆå§‹åŒ–æ—¶ä¸ä¼šç«‹å³æ‰§è¡Œ
            /* watch: {
                courses(newValue, oldValue) {
                    this.totalCount = newValue.length + ' é—¨'
                }
            }, */
            // å¼€é”€å¾ˆå¤§çš„çš„å¼‚æ­¥æ“ä½œè¦ç”¨watch
            watch: {
                courses: {
                    immediate: true, // ç«‹å³æ‰§è¡Œä¸€æ¬¡
                    // deep: true, // ç›‘å¬æ·±å±‚æ¬¡åµŒå¥—æ•°æ®
                    handler(newValue, oldValue) { // ç›‘å¬æ–¹æ³•
                        this.totalCount = newValue.length + ' é—¨'
                    }
                }
            },
            // åˆ›å»ºå®Œæˆ
            async created() {
                // ç»„ä»¶å®ä¾‹å·²åˆ›å»ºï¼ŒæœªæŒ‚è½½ï¼ŒDOMä¸å­˜åœ¨
                const courses = await getCourses();
                this.courses = courses
                // æ‰¹é‡æ›´æ–°å•†å“ä»·æ ¼
                this.batchUpdate()
            },
            // æŒ‚è½½å®Œæˆ
            mounted() {
                // å·²æŒ‚è½½å®ä¾‹ï¼Œå¯ä»¥è®¿é—®DOM
            },
            methods: {
                // æ–°å¢è¯¾ç¨‹
                addCourse() {
                    if (!this.course) {
                        // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
                        // this.showWarn = true
                        this.$refs['msgWarning'].toggle()
                        return false
                    }
                    // æ·»åŠ courseåˆ°æ•°ç»„
                    this.courses.push({
                        name: this.course
                    })
                    this.batchUpdate();
                    this.course = undefined
                    // æ˜¾ç¤ºæç¤ºä¿¡æ¯
                    // this.show = true
                    this.$refs['msgSuccess'].toggle()
                },
                // æ‰¹é‡æ›´æ–°å•†å“ä»·æ ¼
                batchUpdate() {
                    this.courses.map(el => {
                        this.$set(el, 'price', this.price)
                    })
                },
            },
        })
    </script>
</body>

</html>